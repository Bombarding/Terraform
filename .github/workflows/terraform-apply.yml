---
name: Terraform Apply
on:
    workflow_dispatch:

jobs:
  terraform-apply:
    name: Terraform Apply
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
        - name: Checkout
          uses: actions/checkout@v3

        - name: Terraform Init
          working-directory: terraform/
          run: terraform init -backend-config="access_key=${{ secrets.AWS_ACCESS_KEY_ID }}" -backend-config="secret_key=${{ secrets.AWS_SECRET_ACCESS_KEY}}"

        - name: Run Terraform Apply
          uses: dflook/terraform-apply@v1
          with:
            path: terraform/
            auto_approve: true
            backend_config: >
              access_key="${{ secrets.AWS_ACCESS_KEY_ID }}",
              secret_key="${{ secrets.AWS_SECRET_ACCESS_KEY }}",
              bucket="${{ secrets.AWS_BUCKET }}",
